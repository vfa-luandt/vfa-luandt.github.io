(this.webpackJsonpcsv_merge=this.webpackJsonpcsv_merge||[]).push([[0],{39:function(e,a,t){},42:function(e,a,t){},48:function(e,a,t){"use strict";t.r(a);var n=t(0),i=t.n(n),s=t(13),r=t.n(s),l=(t(39),t(23)),o=t.n(l),c=t(27),d=t(28),h=t(29),u=t(8),f=t(34),p=t(33),g=(t.p,t(41),t(53)),b=t(52),j=t(55),v=t(51),m=t(54),O=(t(42),t(18)),x=t.n(O),S=(t(43),t(10)),w=t.n(S),F=t(19),y=t.n(F),C=t(5),D="\u63a5\u7a2e\u5834\u6240",M="\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30ad\u30fc",k="\u65b0\u578b\u30b3\u30ed\u30ca\u63a5\u7a2e\u5238\u3000\u5238\u756a\u53f7",L="\u63a5\u7a2e\u56de\u6570\uff0e",V="\u63a5\u7a2e\u65e5\uff0e",I="\u30e1\u30fc\u30ab\u30fc\uff0e",R=[],N=function(e){Object(f.a)(t,e);var a=Object(p.a)(t);function t(e){var n;return Object(d.a)(this,t),(n=a.call(this,e)).mergeCsv=Object(c.a)(o.a.mark((function e(){var a,t,i,s,r,l,c,d,h,u,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.state.data1,t=n.state.data2,i=n.state.dataKeeper,t.forEach((function(e,t){if(a.has(t)){var n=a.get(t);n["\u63a5\u7a2e\u30ef\u30af\u30c1\u30f3\u306e\u30e1\u30fc\u30ab\u30fc"]=e["\u30e1\u30fc\u30ab\u30fc\uff0e"];var s=y()(new Date(e["\u63a5\u7a2e\u65e5\uff0e"])).format("YYYY-MM-DD");n["\u63a5\u7a2e\u5b9f\u65bd\u65e5"]=s,n["\u72b6\u614b"]="\u5b8c\u4e86",i[n[M]]=n,console.log("merge data "+t)}else R.push(e)})),console.log("data error after merge: "),console.log(R),console.log("finish Merge: "),console.log(i),s=[],i.forEach((function(e){s.push(e)})),console.log("begin parse: "),r=x.a.unparse(s,{}),console.log(r),(l=n.state.nameChanged).length>0&&((c=r.indexOf("\n"))&&(d=r.substring(0,c),h=d.split(","),u=[],h.forEach((function(e){if(e.includes(D)){var a=w.a.findIndex(l,(function(a){return e.includes(a)}));a>=0&&(e=w.a.replace(e,l[a],"\u63a5\u7a2e\u5834\u6240"))}u.push(e)}))),f=w.a.join(u,","),r=r.replace(d,f)),n.input1Ref.current.value="",n.input2Ref.current.value="",n.setState({data1:new Map,data2:new Map,dataKeeper:new Map,nameChanged:[],isLoading:!1,showResults:!0,isFinishMerge:!0,resultData:r,errorFound:R.length>0});case 18:case"end":return e.stop()}}),e)}))),n.downloadToFile=function(e,a,t){var n=document.createElement("a"),i=new Blob([e],{type:t});n.href=URL.createObjectURL(i),n.download=a,n.click(),URL.revokeObjectURL(n.href)},n.state={data1:new Map,data2:new Map,dataKeeper:new Map,nameChanged:[],fileName:"",errorfileName:"",isLoading:!1,showResults:!1,errorFound:!1,isFinishMerge:!1,resultData:""},n.input1Ref=i.a.createRef(),n.input2Ref=i.a.createRef(),n.handleInputFile=n.handleInputFile.bind(Object(u.a)(n)),n.handleMergeData=n.handleMergeData.bind(Object(u.a)(n)),n.exportErrorFile=n.exportErrorFile.bind(Object(u.a)(n)),n.handleDownLoadFileMerged=n.handleDownLoadFileMerged.bind(Object(u.a)(n)),n.resetState=n.resetState.bind(Object(u.a)(n)),n}return Object(h.a)(t,[{key:"checkFileCSV",value:function(e){var a=e.substr(e.lastIndexOf(".")+1);return-1!==w.a.findIndex(["csv"],(function(e){return e==a}))}},{key:"checkFileType",value:function(e){return e&&e.hasOwnProperty(M)?1:e&&e.hasOwnProperty(I)&&e.hasOwnProperty(V)&&e.hasOwnProperty(L)&&e.hasOwnProperty(k)?2:-1}},{key:"handleInvalidData",value:function(e,a){alert(e),a&&(a.target.value="")}},{key:"handleInputFile",value:function(e){var a=this;R=[],this.setState({isLoading:!0,errorFound:!1,isAvailableDownLoad:!1,resultData:"",isFinishMerge:!1});var t=e.target.value.split("\\").pop();this.checkFileCSV(t)?x.a.parse(e.target.files[0],{delimiter:",",header:!0,skipEmptyLines:!0,trimHeaders:!0,complete:function(n){console.log(n.data);var i=w.a.first(null===n||void 0===n?void 0:n.data)||void 0;if(n.errors.length>0||!i)return a.handleInvalidData("The CSV file is empty data, Please choose another file.",e),void a.setState({isLoading:!1});1==a.checkFileType(i)?(a.setState({fileName:t.substr(0,t.lastIndexOf("."))}),a.handleDataFile1(n)):2==a.checkFileType(i)?(a.setState({errorfileName:t.substr(0,t.lastIndexOf("."))}),a.handleDataFile2(n)):(a.handleInvalidData("Invalid data format csv must have\u300c\u65b0\u578b\u30b3\u30ed\u30ca\u63a5\u7a2e\u5238\u3000\u5238\u756a\u53f7\u300d\u3001\u300c\u63a5\u7a2e\u56de\u6570\uff0e\u300d\u3001\u300c\u63a5\u7a2e\u65e5\uff0e\u300d\u3001\u300c\u30e1\u30fc\u30ab\u30fc\uff0e\u300dfields. And, must used UTF-8 encoding.",e),a.setState({isLoading:!1}))},transform:function(e,t){return a.validDataString(e)},transformHeader:function(e,t){if((e=a.validDataString(e))==D){var n=a.state.nameChanged;e=D+t,n.push(e),a.setState({nameChanged:n})}return e}}):this.handleInvalidData("Invalid file type",e)}},{key:"validDataString",value:function(e){for(e=e.replace(new RegExp(/[="]/),"");e.includes('"');)e=e.replace('"',"");return e}},{key:"handleDataFile1",value:function(e){for(var a=new Map,t=new Map,n=0;n<e.data.length;n++){var i=e.data[n];"\u5bfe\u5fdc\u6e08"===i["\u72b6\u614b"]&&"1\u56de\u76ee"===i["\u63a5\u7a2e\u56de\u6570"]&&a.set(i["\u63a5\u7a2e\u5238\u756a\u53f7"],i),t.set(i[M],i)}this.setState({data1:a,dataKeeper:t,isLoading:!1}),console.log("Upload file 1 success")}},{key:"handleDataFile2",value:function(e){console.log(e.data);for(var a=new Map,t=0;t<e.data.length;t++){var n=e.data[t];"1"!==n["\u63a5\u7a2e\u56de\u6570\uff0e"]||w.a.isEmpty(n["\u65b0\u578b\u30b3\u30ed\u30ca\u63a5\u7a2e\u5238\u3000\u5238\u756a\u53f7"])?R.push(n):a.set(n["\u65b0\u578b\u30b3\u30ed\u30ca\u63a5\u7a2e\u5238\u3000\u5238\u756a\u53f7"],n)}this.setState({data2:a,isLoading:!1}),console.log("list data error before merge"),console.log(R),console.log("Upload file 2 success"),console.log(a)}},{key:"validateAddEnoughtFileData",value:function(){this.input1Ref.value&&this.input1Ref.value&&(0==this.state.data1.size||0==this.state.data2.size)&&this.handleInvalidData("Can not merge two csv has same type. You must input SwichSmile CSV and another CSV to merge")}},{key:"handleMergeData",value:function(e){var a=this;this.handleProcessData((function(){a.mergeCsv()}))}},{key:"handleProcessData",value:function(e){this.setState({isLoading:!0},(function(){setTimeout((function(){e()}),1e3)}))}},{key:"resetState",value:function(){this.setState({data1:new Map,data2:new Map,dataKeeper:new Map,nameChanged:[],fileName:"",errorfileName:"",isLoading:!1,showResults:!1,errorFound:!1,resultData:"",isFinishMerge:!1}),R=[]}},{key:"handleDownLoadFileMerged",value:function(){var e=y()(new Date).format("MMDDYYYYhhmm"),a=this.state.fileName+"_merged_"+e+".csv";this.downloadToFile(this.state.resultData,a,"text/csv;charset=utf-8;")}},{key:"exportErrorFile",value:function(){var e=this;w.a.size(R)>0&&this.setState({isLoading:!0},(function(){setTimeout((function(){var a=x.a.unparse(R),t=y()(new Date).format("MMDDYYYYhhmm");e.downloadToFile(a,[e.state.errorfileName,"error",t+".csv"].join("_"),"text/csv;charset=utf-8;"),e.setState({isLoading:!1})}),100)}))}},{key:"render",value:function(){var e=this;return Object(C.jsxs)("div",{className:"App",children:[Object(C.jsxs)(g.a,{bg:"light",expand:"lg",children:[Object(C.jsx)(g.a.Brand,{href:"#home",children:"CSV\u30de\u30fc\u30b8\u30c4\u30fc\u30eb"}),Object(C.jsx)(g.a.Toggle,{"aria-controls":"basic-navbar-nav"})]}),Object(C.jsxs)("div",{className:"container",children:[Object(C.jsxs)(b.a,{className:"form-container",children:[Object(C.jsxs)("label",{className:"form-input-title",children:["\u4f7f\u7528\u65b9\u6cd5\uff1a",Object(C.jsx)("br",{}),"\u2460 \u5065\u5eb7\u30ab\u30eb\u30c6\u306eCSV\u30d5\u30a1\u30a4\u30eb\u304a\u3088\u3073\u4e88\u7d04\u30b7\u30b9\u30c6\u30e0\u306eCSV\u30d5\u30a1\u30a4\u30eb\u3092PC\u304b\u3089\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002",Object(C.jsx)("br",{}),"\xa0\xa0\xa0\xa0\u30fb\u3069\u3061\u3089\u306eCSV\u30d5\u30a1\u30a4\u30eb\u3082\u6587\u5b57\u30b3\u30fc\u30c9\u3092UTF-8\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002",Object(C.jsx)("br",{}),"\xa0\xa0\xa0\xa0\u30fb\u5065\u5eb7\u30ab\u30eb\u30c6\u306eCSV\u30d5\u30a1\u30a4\u30eb\u306f\u300c\u65b0\u578b\u30b3\u30ed\u30ca\u63a5\u7a2e\u5238 \u5238\u756a\u53f7\u300d\u3001\u300c\u751f\u5e74\u6708\u65e5\u300d\u3001\u300c\u63a5\u7a2e\u56de\u6570\uff0e\u300d\u3001\u300c\u63a5\u7a2e\u65e5\uff0e\u300d\u3001\u300c\u30e1\u30fc\u30ab\u30fc\uff0e\u300d\u306e\u30c7\u30fc\u30bf\u3092\u5fc5\u9808\u3068\u3057\u307e\u3059\u3002",Object(C.jsx)("br",{}),"\u2461 2\u3064\u306eCSV\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u5f8c\u3001\u300cCSV\u30de\u30fc\u30b8\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3057\u3066\u304f\u3060\u3055\u3044\u3002",Object(C.jsx)("br",{}),"\u2462 \u300c\u30de\u30fc\u30b8\u3055\u308c\u305f\u4e88\u7d04\u30b7\u30b9\u30c6\u30e0\u306e\u30c7\u30fc\u30bf\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3057\u3066\u3001\u30de\u30fc\u30b8\u3055\u308c\u305fCSV\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002",Object(C.jsx)("br",{}),Object(C.jsx)("br",{}),"\u30de\u30fc\u30b8\u306e\u969b\u306b\u30a8\u30e9\u30fc\u304c\u3042\u3063\u305f\u5834\u5408\u3001\u300c\u30de\u30fc\u30b8\u3055\u308c\u306a\u304b\u3063\u305f\u5065\u5eb7\u30ab\u30eb\u30c6\u306e\u30c7\u30fc\u30bf\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u300d\u30dc\u30bf\u30f3\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002",Object(C.jsx)("br",{}),"\u300c\u30de\u30fc\u30b8\u3055\u308c\u306a\u304b\u3063\u305f\u5065\u5eb7\u30ab\u30eb\u30c6\u306e\u30c7\u30fc\u30bf\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3059\u308b\u3068\u3001\u5065\u5eb7\u30ab\u30eb\u30c6\u4e0a\u306e\u30de\u30fc\u30b8\u3055\u308c\u306a\u304b\u3063\u305f\u5185\u5bb9\u304cCSV\u30d5\u30a1\u30a4\u30eb\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\u3002",Object(C.jsx)("br",{})]}),Object(C.jsxs)("div",{className:"form-input-container",children:[Object(C.jsx)(b.a.Group,{controlId:"file1",children:Object(C.jsx)(b.a.File,{id:"fileCSVFile1",label:"\u5065\u5eb7\u30ab\u30eb\u30c6\u306eCSV\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044",ref:this.input1Ref,onChange:this.handleInputFile})}),Object(C.jsx)(b.a.Group,{controlId:"file2",children:Object(C.jsx)(b.a.File,{id:"fileCSVFile2",label:"\u4e88\u7d04\u30b7\u30b9\u30c6\u30e0\u306eCSV\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044",ref:this.input2Ref,onChange:this.handleInputFile})})]}),this.state.isFinishMerge?Object(C.jsxs)("div",{children:[Object(C.jsx)(j.a,{variant:"primary",type:"button",onClick:this.handleDownLoadFileMerged,disabled:this.state.isLoading,children:"\u30de\u30fc\u30b8\u3055\u308c\u305f\u4e88\u7d04\u30b7\u30b9\u30c6\u30e0\u306e\u30c7\u30fc\u30bf\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9"}),this.state.errorFound&&Object(C.jsx)(C.Fragment,{children:Object(C.jsx)(j.a,{variant:"danger",type:"button",className:"ml-4",onClick:this.exportErrorFile,disabled:this.state.isLoading,children:"\u30de\u30fc\u30b8\u3055\u308c\u306a\u304b\u3063\u305f\u5065\u5eb7\u30ab\u30eb\u30c6\u306e\u30c7\u30fc\u30bf\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9"})})]}):Object(C.jsx)(j.a,{variant:"primary",type:"button",onClick:this.handleMergeData,disabled:this.state.isLoading,children:"CSV\u30de\u30fc\u30b8"})]}),this.state.isLoading?Object(C.jsx)("div",{className:"loading-container",children:Object(C.jsx)(v.a,{className:"loading-content",animation:"border",variant:"primary",role:"status",children:Object(C.jsx)("span",{className:"sr-only",children:"Loading..."})})}):Object(C.jsx)("div",{}),Object(C.jsx)("div",{"aria-live":"polite","aria-atomic":"true",style:{position:"absolute",minHeight:"200px",top:0,right:0},children:Object(C.jsxs)(m.a,{onClose:function(){return e.setState({showResults:!1})},show:!1,delay:5e3,autohide:!0,children:[Object(C.jsx)(m.a.Header,{children:Object(C.jsx)("strong",{className:"mr-auto",children:"Merge CSV complete."})}),Object(C.jsx)(m.a.Body,{children:"merge CSV file complete. The result CSV will be automatic download."})]})})]})]})}}]),t}(i.a.Component);r.a.render(Object(C.jsx)(i.a.StrictMode,{children:Object(C.jsx)(N,{})}),document.getElementById("root"))}},[[48,1,2]]]);
//# sourceMappingURL=main.520ac3ac.chunk.js.map